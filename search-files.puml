@startuml
title Процесс поиска и анализа файлов

actor Сервер
actor Агент

Сервер -> Агент: Получение задачи
note right of Агент: Задача имеет уникальный идентификатор\nи параметры поиска

Агент -> Агент: Настройка параметров
note right of Агент: Применение списка регулярных выражений\nи типов файлов для анализа

loop Периодическое сканирование
    Агент -> Агент: Сканирование файловой системы
    note right of Агент: Обнаружение новых или измененных файлов\nформатов docx, xlsx, pptx, pdf и архивов

    alt Новый или измененный файл найден
        Агент -> Агент: Проверка метаданных файла
        note right of Агент: Дата создания или изменения\nдля определения необходимости анализа

        Агент -> Агент: Открытие файла
        note right of Агент: Использование библиотек для извлечения содержимого

        Агент -> Агент: Извлечение текста
        note right of Агент: docx: Apache POI, docx4j\nxlsx: Apache POI, JExcelAPI\npptx: Apache POI, Aspose.Slides\npdf: Apache PDFBox, iText

        Агент -> Агент: Анализ текста
        note right of Агент: Поиск конфиденциальной информации\nс использованием регулярных выражений

        alt Совпадение найдено
            Агент -> Агент: Фиксация совпадения
            note right of Агент: Запись информации о совпадении
        end

        Агент -> Агент: Сбор данных для сообщения
        note right of Агент: Идентификатор задачи, идентификатор агента,\nпуть к документу, название документа,\nдата обнаружения

        Агент -> Агент: Создание сообщения
    end
end

Агент -> Сервер: Отправка сообщения
note left of Сервер: Через защищенный канал связи

alt Сообщение получено
    Сервер -> Агент: Подтверждение получения
else Сообщение не получено
    loop Повторная отправка
        Агент -> Сервер: Повторная отправка сообщения
        note left of Сервер: Через определенные интервалы времени
    end
end

Агент -> Агент: Ведение журнала
note right of Агент: Фиксация всех действий\nи отправка логов на сервер
@enduml